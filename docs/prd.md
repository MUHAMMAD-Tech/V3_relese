# LETHEX Digital Asset Fund Management System Requirements Document

## 1. Application Overview

### 1.1 Application Name
LETHEX\n
### 1.2 Application Description
LETHEX is a digital asset fund viewer and manual management system designed for fund administrators and holders. The platform provides informational balance tracking, manual transaction approval workflows, and real-time cryptocurrency price monitoring. No blockchain interaction or real money processing is involved - all operations require manual admin approval.\n
### 1.3 Core Positioning
- Informational digital asset portfolio viewer
- Manual approval-based transaction management
- Admin-controlled fund operations
- Real-time price tracking with dual currency display (USDT + KGS)
- Multi-language support (EN/UZ/RU)
- Light/Dark theme switching

## 2. Technical Architecture

### 2.1 Frontend Stack
- React (Vite)\n- Tailwind CSS (mobile-first approach with theme support)
- Zustand (global state management)
- Framer Motion (animations)
- i18n system (JSON-based localization)
- IndexedDB (local price caching and offline persistence)

### 2.2 Backend Stack
- Node.js + Express\n- SQLite (single-file database)
- REST API architecture
- Token registry system
\n### 2.3 External APIs
- CoinGecko public API\n- Price refresh interval: 1 second
- Backend caching with fail-safe mechanism

### 2.4 Local Storage Architecture
- IndexedDB for structured data storage
- Stores: holders list, transaction history, asset balances, price cache
- Price updates propagate to all open pages via BroadcastChannel API
- Automatic sync on login/page load
- Offline-first approach with background sync

## 3. Access Control System

### 3.1 Initial Admin Access
- Default admin access code: Muso2909 (temporary, first-time use only)
- Single unified login input for both admin and holders
- No separate /admin route
\n### 3.2 Access Code Logic
- Admin access code checked first
- If match → Admin Panel\n- If holder code match → Holder Dashboard
- If no match → 'Invalid access code' error

### 3.3 Admin Code Management
- Admin can change access code via Admin Panel → Settings
- Only ONE admin access code exists at any time
- New code stored in database
- Old code becomes invalid immediately upon change

### 3.4 Holder Access Codes
- Auto-generated by admin
- Unique per holder
- Admin can manually change holder access codes
- Session persists after page refresh
- EXIT button clears session
- Active sessions using old code invalidated immediately upon code change

## 4. Token System

### 4.1 Token Registry (Backend)
- Tokens stored in database table or JSON file
- On server startup:\n  - If tokens table is empty → auto-insert DEFAULT Top-50 native coins
- Token source priority:
  1. CoinGecko API (top by market cap)
  2. Cached data\n  3. Hardcoded fallback Top-50 list
- Each token record contains:
  - symbol
  - name
  - icon URL
  - market cap rank
  - enabled = true\n- API endpoint: GET /api/tokens
- API MUST NEVER return empty array
- If API fails → use cache or fallback

### 4.2 Allowed Tokens (Top 50 Native Coins Only)
1. BTC – Bitcoin
2. ETH – Ethereum
3. USDT – Tether
4. BNB – Binance Coin
5. SOL – Solana
6. USDC – USD Coin
7. XRP – XRP
8. TON – Toncoin
9. ADA – Cardano
10. DOGE – Dogecoin
11. AVAX – Avalanche
12. TRX – TRON
13. DOT – Polkadot\n14. MATIC – Polygon
15. LINK – Chainlink
16. ICP – Internet Computer
17. NEAR – NEAR Protocol
18. LTC – Litecoin
19. BCH – Bitcoin Cash
20. ATOM – Cosmos
21. XLM – Stellar
22. UNI – Uniswap
23. ETC – Ethereum Classic
24. XMR – Monero
25. OKB – OKB\n26. APT – Aptos
27. HBAR – Hedera
28. FIL – Filecoin\n29. ARB – Arbitrum
30. VET – VeChain
31. QNT – Quant
32. MKR – Maker
33. CRO – Cronos
34. ALGO – Algorand
35. AAVE – Aave
36. GRT – The Graph
37. EOS – EOS
38. FTM – Fantom
39. THETA – Theta
40. XTZ – Tezos\n41. IMX – Immutable
42. INJ – Injective
43. OP – Optimism
44. RNDR – Render
45. KAVA – Kava
46. ZEC – Zcash
47. MINA – Mina
48. DASH – Dash
49. IOTA – IOTA
50. CAKE – PancakeSwap

### 4.3 Token Restrictions
- NO wrapped tokens
- NO staked tokens
- NO LP tokens
- NO synthetic or derivative tokens
- Whitelist enforced at backend level
- Non-whitelisted tokens: not rendered, not selectable, not assignable

### 4.4 Token Selector UI
- Fetch tokens ONLY from backend (/api/tokens)
- Store tokens in global state
- Modal-based selection interface
- Fixed header: 'Select Asset'
- Sticky search input at top
- Scrollable list (max-height: 80vh)
- Visible Close (X) button
- Each token row displays:
  - Token logo (left)
  - Symbol (bold)
  - Full name (muted text)
  - Live price (right-aligned)
- Clear hover and selected states
- Smooth scrolling on Android and desktop
- Solid backgrounds (no transparency)
- Tokens MUST appear on first open
- 'No tokens found' ONLY if search filter returns zero results
- Native coins selectable on mobile & desktop

## 5. Internationalization (i18n)

### 5.1 Supported Languages
- English (EN) — default
- Uzbek (UZ)
- Russian (RU)
\n### 5.2 Implementation\n- JSON-based i18n system
- Localization files:\n  - /locales/en.json
  - /locales/uz.json
  - /locales/ru.json
- No hardcoded text in components
- Language applies to entire app
\n### 5.3 Language Switcher UI
- Dropdown selector (EN / UZ / RU)
- Visible in header
- On mobile → inside menu/drawer
- Touch-friendly
\n### 5.4 Persistence
- Save selected language in localStorage
- Refresh MUST NOT reset language
- Language persists across sessions
\n## 6. Theme System

### 6.1 Available Themes
- Dark (default)
- Light
\n### 6.2 Implementation
- Tailwind class-based theming
- Apply theme class on <html> or <body>
- Entire app switches theme
- No mixed colors\n- Smooth transition animations

### 6.3 Theme Toggle UI
- Toggle button with Sun/Moon icon
- Visible in header
- Mobile friendly
- Clear visual feedback

### 6.4 Persistence
- Save theme choice in localStorage
- Refresh MUST NOT reset theme
- Theme persists across sessions

## 7. Admin Panel Features

### 7.1 Settings\n- Change admin access code
- System configuration
\n### 7.2 Holder Management
- Add new holders
- Edit holder information
- Delete holders
- Auto-generate unique holder access codes
- **Change holder access codes:**
  - Button: 'Change Access Code'
  - Generate new random code OR manual input
  - Save to backend database
  - Old code becomes INVALID immediately
  - No duplicate access codes allowed
  - Active sessions using old code invalidated

### 7.3 Asset Management
- Assign assets to holders (Top-50 tokens only)
- Edit asset amounts
- View holder portfolios
\n### 7.4 Transaction Approval
- Approve/reject swap requests
- Approve buy requests
- Handle sell requests manually
- Enter execution prices for swaps
\n### 7.5 History & Reporting
- View complete transaction history (see Section 13)
- View commission summary (see Section 12)
\n### 7.6 Active Assets (Enhanced)
- View aggregated balances across all holders
- Total USD & KGS value display
- Token-wise totals (BTC, ETH, USDT, etc)\n- **NEW: Visual portfolio composition graphs** (see Section 18)
- **NEW: Asset-to-holder breakdown view** (see Section 18)
- **NEW: CSV export functionality** (see Section 18)

## 8. Holder Dashboard Features

### 8.1 Portfolio View
- View assigned assets
- Live prices in USDT and KGS
- Real-time balance updates
\n### 8.2 Transaction Requests
- Submit swap requests
- Submit buy requests
- Submit sell requests
\n### 8.3 History\n- View personal transaction history (see Section 13)
- Click for detailed transaction information

## 9. Swap System

### 9.1 Swap Rules
- Only owned assets can be swapped
- Swap fee: 1% of transaction amount
- Amount validation:
  - Requested amount must not exceed holder balance
  - Insufficient balance blocks transaction
\n### 9.2 Swap Calculation
- Fee = amount × 0.01
- Net = amount - Fee
- Received = Net ÷ executionPrice
\n### 9.3 Swap UI
- Clean numeric amount input field
- Quick percentage buttons: 25% / 50% / 75% / 100%
- Live preview display:\n  - Transaction fee\n  - Net amount after fee
  - Estimated tokens received
\n### 9.4 Swap Approval Flow
- Holder submits swap request
- Admin enters execution price manually
- Admin approves swap
- Balances update atomically
- History record created after approval

## 10. Buy System

### 10.1 Buy Flow
- Holder submits buy request
- Admin reviews request
- Admin approves and adds asset to holder portfolio
- History record created after approval

## 11. Sell System

### 11.1 Sell Flow
- Holder submits sell request
- System displays message: 'Please contact admin via Telegram'
- Admin adjusts balances manually after off-platform confirmation
- History record created after acknowledgment

## 12. Commission System
\n### 12.1 Fee Collection
- 1% fee collected on each swap transaction
- Fees stored per transaction in database
\n### 12.2 Commission Reporting (Admin Only)
\n#### 12.2.1 Backend Implementation
- Commission data comes from approved transactions
- Commission = feeAmount\n\n**API Endpoint:**
\nGET /api/commissions

**Response Structure:**
```json
{\n  \"totalCommission\": number (USDT),
  \"breakdown\": {
    \"swap\": number,
    \"buy\": number,
    \"sell\": number\n  },
  \"list\": [
    {
      \"transactionId\": string,
      \"holderName\": string,
      \"type\": \"swap\" | \"buy\" | \"sell\",
      \"asset\": string,
      \"feePercent\": number,
      \"feeAmount\": number,
      \"createdAt\": timestamp
    }
  ]
}
```
\n#### 12.2.2 Frontend Implementation
\n**Page Structure:**
\n**Top Summary Section:**
- Total commissions collected (USDT)
- Breakdown by transaction type:\n  - Swap fees\n  - Buy fees
  - Sell fees
\n**Commission List:**
- Date
- Holder name
- Transaction type
- Asset
- Fee percentage
- Fee amount (USDT)
\n**Filters:**
- Search by holder name
\n**Empty State:**
- If no commissions: display 'No commissions collected yet'
\n**Mobile Layout:**
- Card-based layout
- Scrollable list
- No overlapping text
- Touch-friendly elements

**Desktop Layout:**
- Table format
- Sortable columns
- Clear visual hierarchy
\n## 13. Transaction History\n
### 13.1 History Creation Rules
- History records created ONLY after:\n  - Swap approved
  - Buy approved
  - Sell acknowledged
\n### 13.2 History Entry Fields
- id (transaction id)
- type: swap | buy | sell
- holderName
- fromAsset
- toAsset (nullable for buy/sell)
- amountFrom
- amountTo\n- feePercent
- feeAmount\n- priceUsed (execution price)
- status
- createdAt (requested timestamp)
- approvedAt (approved timestamp)
\n### 13.3 Backend API
\n**GET /api/history**
- Admin → returns ALL history
- Holder → returns ONLY own history
\n**GET /api/history/:id**\n- Returns full transaction details
\n### 13.4 History Page UI (Admin)\n
**Search Functionality:**
- Search input at top of page
- Search by:\n  - Holder name
  - Transaction ID
\n**List/Table Display:**
- Date\n- Holder name
- Transaction type
- Assets (FROM → TO)
- Amount
- Fee\n- Status
\n**Mobile Layout:**
- Card-based layout
- Scrollable\n- No overlapping text
\n**Desktop Layout:**
- Table format
- Sortable columns
\n**Empty State:**
- If no transactions: display 'No transactions yet'\n
### 13.5 History Page UI (Holder)

**Display:**
- Shows only own transactions
- Clean list view
- Same fields as admin view (excluding holder name)

**Mobile Optimization:**
- Card layout
- Touch-friendly
- Smooth scrolling

### 13.6 Transaction Details View

**Trigger:**
- Click on any history item
\n**Display Format:**
- Modal/overlay\n\n**Information Displayed:**
- Transaction ID
- Holder name (admin view only)
- Transaction type
- From asset
- To asset
- Amount before fee
- Fee percentage and fee amount
- Net amount\n- Execution price
- Status
- Created time
- Approved time

**Mobile Requirements:**
- Scrollable content
- No overlapping text
- Close button MUST work
- Touch-friendly layout

**Desktop Requirements:**
- Centered modal
- Clear visual hierarchy
- Proper spacing

## 14. Responsive Design Requirements

### 14.1 Mobile Layout
- Single-column layout
- Sidebar converts to hamburger drawer
- Tables convert to card format
- Full-width buttons (minimum 44px height)
- No content overlap or hidden elements
- Touch-friendly buttons (≥44px)\n- Asset selector scrolls smoothly
- History and Commissions pages use card layout
- Transaction details modal scrollable

### 14.2 Desktop Layout
- Visible sidebar navigation
- Grid/table layouts allowed
- Centered modals
- Optimized spacing
- History and Commissions pages use table layout
\n## 15. UI/UX Design Guidelines

### 15.1 Design Style
- Premium dark fintech aesthetic (Dark theme)
- Deep charcoal backgrounds (#0f1419, #1a1f26)
- Accent colors: electric blue (#00d4ff) for primary actions, amber (#fbbf24) for warnings
- Light theme: clean white/light gray backgrounds with adjusted accent colors
- Subtle card elevation with soft shadows
- Clean sans-serif typography (Inter or similar)
- Smooth micro-interactions and transitions
- Smooth theme transition animations

### 15.2 Interaction Standards
- No browser alert() dialogs
- Custom modal components for all confirmations
- Proper empty states with helpful messaging
- Loading states with skeleton screens
- Smooth Framer Motion animations
- Clear visual hierarchy\n- No 'No tokens found' on first load
- No 'Coming Soon' placeholders anywhere

### 15.3 Data Display
- No fake $0.00 prices
- Real-time price updates
- Proper number formatting
- Clear currency indicators (USDT/KGS)
- Empty states show meaningful messages:\n  - 'No transactions yet' (History)
  - 'No commissions collected yet' (Commissions)

## 16. Development Standards

### 16.1 Code Quality
- Brand-new codebase from scratch
- No legacy code reuse
- No carryover bugs
- Clean, consistent code structure
- Production-ready implementation

### 16.2 Testing Requirements
- Responsive testing on mobile and desktop
- Token whitelist enforcement testing
- Access control validation
- Transaction flow testing
- Price update reliability testing
- Language switching testing
- Theme switching testing
- Holder access code change testing
- Token loading reliability testing
- History page functionality testing
- Commissions page functionality testing
- Transaction details modal testing
- Active Assets enhanced features testing (graphs, breakdown, CSV export)
- Local storage sync testing
- Price propagation across tabs testing
- Offline functionality testing

### 16.3 Persistence Testing
- Language persists after refresh
- Theme persists after refresh
- All settings persist across sessions
- Local price cache persists across sessions
- Holder data syncs correctly on login
\n## 17. Final Requirements Summary

### 17.1 Core Features
- Top-50 native coins always visible
- Language switching works everywhere (EN/UZ/RU)\n- Light/Dark theme works everywhere
- Admin can safely change holder access codes
- All settings persist after refresh
- Clean, stable, professional UX
- Fully functional History page (admin + holder)
- Fully functional Commissions page (admin only)
- Transaction details view working correctly
- Enhanced Active Assets with visual insights, breakdown, and export
- Local price caching with real-time sync across tabs
- No price reloading on navigation or page refresh

### 17.2 Quality Standards
- Works on mobile & desktop
- No overlapping elements
- Asset selector scrolls smoothly
- Touch-friendly buttons (≥44px)
- No 'No tokens found' on first load
- No 'Coming Soon' placeholders
- Production-ready stability
- Real transaction data displayed
- Proper empty states with meaningful messages
- Charts and graphs perform smoothly on mobile
- No UI blocking or freezing
- Instant price updates without page reload
- Seamless navigation without data loss

## 18. Active Assets Enhanced Features (Admin Only)

### 18.1 Overview
The Active Assets section displays aggregated portfolio data across all holders. This section is enhanced with three advanced features:
1. Visual portfolio composition graphs\n2. Asset-to-holder breakdown view
3. CSV export functionality

**Access Control:**
- Admin only\n- No holder access\n- Read-only insights

### 18.2 Visual Graphs
\n#### 18.2.1 Graph Section Layout
- Position: ABOVE the assets list
- Graph type: Donut/Pie chart (primary)
- Optional: Bar chart toggle
\n#### 18.2.2 Graph Data
- Each slice represents one asset
- Value = total USD value of that asset
- Only assets with balance > 0 included
- Colors must be consistent per asset

#### 18.2.3 Tooltip Display
On hover (desktop) or tap (mobile), show:
- Asset symbol
- Total amount
- USD value
- Percentage of total portfolio
\n#### 18.2.4 Mobile Requirements
- Chart scales responsively
- Touch-friendly tooltip
- Smooth rendering without lag

#### 18.2.5 Desktop Requirements
- Hover tooltip
- Legend displayed on the side
- Clear visual hierarchy

### 18.3 Asset-to-Holder Breakdown\n
#### 18.3.1 Interaction Trigger
- Admin clicks on an asset row (e.g., BTC)
\n#### 18.3.2 Modal Display
- Title: '[Asset Symbol] — Holder Distribution'
- Display asset symbol and logo
- Show total amount (global)
\n#### 18.3.3 Holder List Content
Each row displays:
- Holder name
- Holder access code (masked, e.g., ****X9A)
- Amount of this asset
- USD value
\n#### 18.3.4 Display Rules
- Show ONLY holders with amount > 0
- Sorted by amount DESC
- Read-only (no edit functionality)

#### 18.3.5 Empty State
- Message: 'No holders currently hold this asset'
\n#### 18.3.6 Mobile Layout
- Full-screen modal
- Scroll enabled
- Touch-friendly elements
- Close button clearly visible

#### 18.3.7 Desktop Layout
- Centered modal\n- Max-width container
- Proper spacing and hierarchy

### 18.4 CSV Export

#### 18.4.1 Export Button
- Label: 'Export CSV'
- Location: Top-right of Active Assets page
- Touch-friendly size (≥44px)
\n#### 18.4.2 CSV File Structure
**Filename:** active_assets_report.csv
\n**Columns:**
- Asset Symbol
- Total Amount
- Price USD
- Total Value USD
- Total Value KGS
\n#### 18.4.3 Advanced Export (Optional)
When exporting from asset detail modal:
- Export per-holder breakdown
- Additional columns:\n  - Holder Name
  - Amount
  - USD Value
\n#### 18.4.4 Export Rules
- CSV generated from BACKEND data
- No frontend-only calculations
- Export values must match UI values exactly
- No blocking UI during export
- Success feedback after export completion

### 18.5 Backend API Requirements

#### 18.5.1 Active Assets Endpoint
**GET /api/active-assets**
\n**Response Structure:**
```json
{\n  \"totalUsd\": number,
  \"totalKgs\": number,\n  \"assets\": [
    {\n      \"symbol\": string,
      \"name\": string,
      \"iconUrl\": string,
      \"totalAmount\": number,\n      \"priceUsd\": number,\n      \"totalUsdValue\": number,
      \"totalKgsValue\": number,
      \"holders\": [
        {
          \"holderId\": string,
          \"holderName\": string,
          \"holderAccessCode\": string,\n          \"amount\": number,
          \"usdValue\": number\n        }
      ]\n    }
  ]\n}
```

#### 18.5.2 Caching Strategy
- Cache result for 5-10 seconds
- Recalculate on holder balance changes
- Ensure data consistency with UI
\n#### 18.5.3 CSV Export Endpoint
**GET /api/active-assets/export**

**Query Parameters:**
- format: 'csv'
- assetSymbol (optional): for per-asset breakdown
\n**Response:**
- Content-Type: text/csv
- Content-Disposition: attachment; filename='active_assets_report.csv'\n\n### 18.6 UX & Performance Rules

#### 18.6.1 Interaction Standards
- No page reloads\n- No blocking UI
- Smooth animations (Framer Motion)
- Charts must not lag on mobile
- Scroll must never freeze

#### 18.6.2 Loading States
- Skeleton screens for graphs while loading
- Loading indicator for CSV export
- Smooth transitions between states

#### 18.6.3 Error Handling
- Graceful error messages if data fails to load
- Retry mechanism for failed requests
- No broken UI states

### 18.7 Design Consistency

#### 18.7.1 Visual Style
- Follow existing fintech aesthetic
- Consistent color scheme with theme (Dark/Light)
- Electric blue (#00d4ff) for interactive elements
- Proper contrast ratios for accessibility

#### 18.7.2 Typography
- Clean sans-serif font (Inter or similar)
- Clear hierarchy in modal headers
- Readable font sizes on mobile

#### 18.7.3 Spacing & Layout
- Consistent padding and margins
- Proper card elevation
- Clear visual separation between sections

### 18.8 Final Result Requirements

**Admin Experience:**
- Visual portfolio composition at a glance
- Drill-down capability per asset → per holder
- Accurate CSV export for reporting
- Clean, professional, fintech-grade UX
- Smooth performance on mobile and desktop
- No functionality removed from existing Active Assets layout
- All enhancements work seamlessly with existing features

## 19. Local Storage & Price Caching System

### 19.1 Overview
Implement a robust local storage system using IndexedDB to cache cryptocurrency prices, holder data, and other critical information. This eliminates slow price reloading on navigation and ensures seamless user experience across page transitions.

### 19.2 IndexedDB Structure

#### 19.2.1 Database Name\n- lethex_local_db

#### 19.2.2 Object Stores
\n**Store 1: prices**
- Key: symbol (string)
- Fields:\n  - symbol: string
  - priceUsd: number
  - priceKgs: number\n  - lastUpdated: timestamp
\n**Store 2: holders**
- Key: holderId (string)
- Fields:
  - holderId: string
  - holderName: string
  - holderAccessCode: string
  - assets: array of {symbol, amount}\n  - lastSynced: timestamp

**Store 3: transactions**
- Key: transactionId (string)
- Fields:\n  - All transaction history fields (see Section 13.2)
  - lastSynced: timestamp

**Store 4: metadata**
- Key: key (string)
- Fields:
  - key: string (e.g., last_sync_time, app_version)
  - value: any\n
### 19.3 Price Update Strategy

#### 19.3.1 Background Price Sync
- Continuous price updates every 1 second (as specified)\n- Updates stored in IndexedDB immediately
- No UI blocking during updates

#### 19.3.2 Price Propagation Across Tabs
- Use BroadcastChannel API for cross-tab communication
- Channel name: lethex_price_updates
- When prices update in one tab:\n  1. Save to IndexedDB
  2. Broadcast update event to all open tabs
  3. All tabs receive and apply updates instantly

#### 19.3.3 Price Loading on Page Load
- On app initialization:\n  1. Load cached prices from IndexedDB immediately
  2. Display cached prices instantly (no loading delay)
  3. Start background sync in parallel
  4. Update UI smoothly when fresh prices arrive

#### 19.3.4 Offline Handling
- If network unavailable:\n  - Display last cached prices
  - Show offline indicator
  - Continue using cached data
- When network restored:
  - Resume background sync automatically
  - Update prices seamlessly

### 19.4 Holder Data Sync

#### 19.4.1 Initial Sync on Login
- On successful login:
  1. Fetch holder data from backend
  2. Store in IndexedDB
  3. Mark sync timestamp
\n#### 19.4.2 Incremental Sync
- Check for updates every 30 seconds
- Only fetch changed data (delta sync)
- Update IndexedDB incrementally
\n#### 19.4.3 Manual Refresh
- Pull-to-refresh gesture on mobile
- Refresh button on desktop
- Force full sync from backend

### 19.5 Navigation Optimization

#### 19.5.1 No Price Reloading
- When navigating between pages:
  - Prices loaded from IndexedDB instantly
  - No API calls on navigation
  - No loading spinners for prices
  - Smooth, instant transitions

#### 19.5.2 State Persistence
- Current page state saved in sessionStorage
- Scroll position preserved
- Form inputs retained
- No data loss on navigation

### 19.6 Data Consistency Rules

#### 19.6.1 Cache Invalidation
- Price cache: never expires (continuously updated)
- Holder data cache: 5 minutes TTL
- Transaction history cache: 10 minutes TTL
- Force refresh on critical actions (approve transaction, change balance)

#### 19.6.2 Conflict Resolution
- Backend data always takes precedence
- On conflict: overwrite local cache with backend data
- Log conflicts for debugging

#### 19.6.3 Data Integrity
- Validate data before storing in IndexedDB
- Reject malformed or incomplete data
- Maintain referential integrity between stores

### 19.7 Performance Requirements

#### 19.7.1 Speed Benchmarks
- Price load from cache: < 50ms
- Holder data load from cache: < 100ms
- IndexedDB write operation: < 20ms
- Cross-tab price propagation: < 100ms\n
#### 19.7.2 Storage Limits
- Maximum IndexedDB size: 50MB\n- Automatic cleanup of old transaction records (keep last 1000)\n- Price history not stored (only current prices)

#### 19.7.3 Memory Management
- Lazy load transaction details
- Paginate large datasets
- Clear unused data from memory
\n### 19.8 Implementation Details

#### 19.8.1 IndexedDB Wrapper
- Create abstraction layer for IndexedDB operations\n- Promise-based API\n- Error handling and retry logic
- Transaction management

#### 19.8.2 BroadcastChannel Setup
```javascript
const priceChannel = new BroadcastChannel('lethex_price_updates');
\n// Send price update
priceChannel.postMessage({
  type: 'PRICE_UPDATE',
  data: { symbol: 'BTC', priceUsd: 45000, priceKgs: 3900000 }
});
\n// Receive price update
priceChannel.onmessage = (event) => {
  if (event.data.type === 'PRICE_UPDATE') {\n    updatePriceInUI(event.data.data);
  }
};
```

#### 19.8.3 Price Sync Service
- Singleton service running in background
- Manages WebSocket or polling connection
- Writes to IndexedDB on every update
- Broadcasts to all tabs
- Handles reconnection logic

### 19.9 Error Handling

#### 19.9.1 IndexedDB Errors
- QuotaExceededError: clear old data, retry
- VersionError: migrate database schema
- Generic errors: fallback to API calls

#### 19.9.2 Network Errors\n- Display cached data with offline indicator
- Queue failed requests for retry
- Auto-retry with exponential backoff

#### 19.9.3 Data Corruption
- Detect corrupted data on read
- Clear corrupted store\n- Re-fetch from backend\n- Log error for debugging

### 19.10 Testing Requirements

#### 19.10.1 Functional Tests
- Price caching and retrieval
- Cross-tab price propagation
- Offline mode functionality
- Data sync after network restoration
- Navigation without price reload

#### 19.10.2 Performance Tests
- Measure cache read/write speed
- Test with 1000+ transactions
- Verify no memory leaks
- Check smooth scrolling with cached data

#### 19.10.3 Edge Cases
- Multiple tabs open simultaneously
- Rapid navigation between pages
- Network switching (WiFi ↔ Mobile)
- Browser storage quota exceeded
- IndexedDB not supported (fallback to API)

### 19.11 Final Result\n
**User Experience:**
- Instant price display on every page
- No loading spinners for prices
- Smooth navigation without delays
- Works offline with cached data
- Real-time updates across all open tabs
- No price reloading on page refresh
- Professional, seamless experience